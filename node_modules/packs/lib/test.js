"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const echo_1 = require("packs-framework/lib/echo");
const path_1 = require("path");
const jsdom_1 = require("jsdom");
// mock browser
const { window } = new jsdom_1.JSDOM();
const globalAny = global;
globalAny.document = window.document;
const components = require(path_1.resolve(process.cwd(), "./public/components"));
const modules = require(path_1.resolve(process.cwd(), "./.packs/modules"));
const initialState = require(path_1.resolve(process.cwd(), "./.packs/initialState"));
console.log("Initial state:", JSON.stringify(initialState, null, 2));
function assignProps(params, state) {
    for (let k in params) {
        params[k] = echo_1.default(params[k], state);
    }
    return params;
}
const simulated = modules.reduce((data, m, i) => {
    const component = components[m.component];
    component.defaultProps = component.defaultProps || {};
    const props = Object.assign({}, assignProps(component.defaultProps, data), assignProps(m, data));
    const simulated = component.hasOwnProperty("simulate") && component.simulate(props);
    const response = !simulated ? {} : simulated;
    response[`module_${i}_component`] = m.componentName;
    response[`module_${i}_t`] = Date.now();
    console.log(`Module ${i}:`, JSON.stringify(response, null, 2));
    return Object.assign(data, response);
}, initialState);
console.log("Final simulated response state:", JSON.stringify(simulated, null, 2));
//# sourceMappingURL=test.js.map